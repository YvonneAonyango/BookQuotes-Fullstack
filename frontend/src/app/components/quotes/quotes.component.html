<div class="quotes-page">
  <div class="page-header">
    <h1>{{ 'myQuotes' | translate }}</h1>
    <p class="lead">{{ 'Save and manage your favorite quotes' | translate }}</p>
  </div>

  <div class="quote-form-section mb-4">
    <div class="card">
      <div class="card-header bg-primary text-white">
        <h5 class="mb-0">
          <i class="bi bi-chat-quote me-2"></i>
          {{ isEdit ? ('editQuote' | translate) : ('addNewQuote' | translate) }}
        </h5>
      </div>
      <div class="card-body">
        <form [formGroup]="quoteForm" (ngSubmit)="onSubmit()">
          <div class="row g-3">
            <div class="col-12">
              <label for="text" class="form-label">{{ 'Quote Text' | translate }} *</label>
              <textarea class="form-control" 
                        id="text" 
                        formControlName="text"
                        rows="3"
                        [placeholder]="'Enter the quote text...' | translate"
                        [class.is-invalid]="quoteForm.get('text')?.invalid && quoteForm.get('text')?.touched"></textarea>
              <div class="invalid-feedback" *ngIf="quoteForm.get('text')?.errors?.['required']">
                {{ 'Quote text is required' | translate }}
              </div>
              <div class="invalid-feedback" *ngIf="quoteForm.get('text')?.errors?.['minlength']">
                {{ 'Quote must be at least 10 characters long' | translate }}
              </div>
            </div>
            
            <div class="col-md-6">
              <label for="author" class="form-label">{{ 'Author' | translate }} *</label>
              <input type="text" 
                     class="form-control" 
                     id="author" 
                     formControlName="author"
                     [placeholder]="'Enter author name' | translate"
                     [class.is-invalid]="quoteForm.get('author')?.invalid && quoteForm.get('author')?.touched">
              <div class="invalid-feedback" *ngIf="quoteForm.get('author')?.errors?.['required']">
                {{ 'Author is required' | translate }}
              </div>
            </div>
            
            <div class="col-md-6">
              <label for="bookId" class="form-label">{{ 'From Book (Optional)' | translate }}</label>
              <select class="form-select" id="bookId" formControlName="bookId">
                <option value="">{{ 'Select a book...' | translate }}</option>
                <option *ngFor="let book of books" [value]="book.id">{{ book.title }}</option>
              </select>
            </div>
            
            <div class="col-12">
              <div class="d-flex gap-2">
                <button type="submit" class="btn btn-primary" [disabled]="quoteForm.invalid || isLoading">
                  <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2"></span>
                  {{ isEdit ? ('updateBook' | translate) : ('addBook' | translate) }}
                </button>
                <button type="button" class="btn btn-secondary" (click)="cancelForm()" *ngIf="isEdit">
                  {{ 'cancel' | translate }}
                </button>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="quote-basket-section mb-4" *ngIf="addedQuotes.length > 0">
    <div class="card">
      <div class="card-header bg-info text-white">
        <h5 class="mb-0">
          <i class="bi bi-basket me-2"></i>
          {{ 'Your Quote Basket' | translate }} ({{ addedQuotes.length }})
          <small class="float-end">{{ 'Click any quote to edit' | translate }}</small>
        </h5>
      </div>
      <div class="card-body">
        <div class="quote-badges">
          <div *ngFor="let quote of addedQuotes" class="quote-badge" (click)="editQuoteFromBadge(quote)" [class.selected]="selectedQuoteId === quote.id">
            <div class="badge-content">
              <div class="quote-text">"{{ quote.text | truncate:80 }}"</div>
              <div class="quote-meta">
                <span class="author">— {{ quote.author }}</span>
                <span class="book" *ngIf="getBookTitle(quote.bookId)">
                  • {{ 'From:' | translate }} {{ getBookTitle(quote.bookId) }}
                </span>
              </div>
            </div>
            <div class="badge-actions">
              <button class="btn btn-sm btn-outline-primary" (click)="editQuoteFromBadge(quote); $event.stopPropagation()">
                <i class="bi bi-pencil"></i>
              </button>
              <button class="btn btn-sm btn-outline-danger" (click)="removeFromBasket(quote.id!); $event.stopPropagation()">
                <i class="bi bi-trash"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="existing-quotes-section" *ngIf="!isLoading && quotes.length > 0">
    <h3 class="mb-3">{{ 'All Quotes' | translate }}</h3>
    <div class="quotes-grid">
      <div *ngFor="let quote of quotes" class="quote-card">
        <div class="quote-card-header">
          <i class="bi bi-chat-quote quote-icon"></i>
          <button class="btn btn-sm btn-outline-success add-to-basket-btn" (click)="addToBasket(quote)" [disabled]="isInBasket(quote.id!)">
            <i class="bi bi-plus"></i> {{ 'Add to Basket' | translate }}
          </button>
        </div>
        <div class="quote-card-body">
          <p class="quote-text">"{{ quote.text }}"</p>
          <div class="quote-footer">
            <span class="quote-author">— {{ quote.author }}</span>
            <span class="quote-book" *ngIf="getBookTitle(quote.bookId)">
              <i class="bi bi-book me-1"></i>{{ getBookTitle(quote.bookId) }}
            </span>
          </div>
        </div>
        <div class="quote-card-footer">
          <button class="btn btn-sm btn-primary" (click)="editQuoteFromBadge(quote)">
            <i class="bi bi-pencil"></i>
          </button>
          <button class="btn btn-sm btn-danger" (click)="deleteQuote(quote.id!)">
            <i class="bi bi-trash"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">{{ 'loading' | translate }}</span>
    </div>
    <p class="mt-2">{{ 'Loading quotes...' | translate }}</p>
  </div>

  <div *ngIf="!isLoading && quotes.length === 0 && addedQuotes.length === 0" class="empty-state text-center py-5">
    <i class="bi bi-chat-quote text-muted" style="font-size: 4rem;"></i>
    <h3 class="mt-3">{{ 'No quotes yet' | translate }}</h3>
    <p class="text-muted">{{ 'Start by adding your first quote using the form above!' | translate }}</p>
  </div>
</div>
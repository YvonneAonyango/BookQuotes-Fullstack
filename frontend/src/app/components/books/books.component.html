<div class="books-page">
  <div class="page-header">
    <h1>My Books</h1>
    <p class="lead">Manage your book collection</p>
  </div>

  <!-- BOOK FORM (Visible immediately when entering page) -->
  <div class="book-form-section mb-4">
    <div class="card">
      <div class="card-header bg-primary text-white">
        <h5 class="mb-0">
          <i class="bi bi-plus-circle me-2"></i>
          {{ isEditing ? 'Edit Book' : 'Add New Book' }}
        </h5>
      </div>
      <div class="card-body">
        <form [formGroup]="bookForm" (ngSubmit)="onSubmit()">
          <div class="row g-3">
            <div class="col-md-6">
              <label for="title" class="form-label">Book Title *</label>
              <input type="text" 
                     class="form-control" 
                     id="title" 
                     formControlName="title"
                     placeholder="Enter book title"
                     [class.is-invalid]="bookForm.get('title')?.invalid && bookForm.get('title')?.touched">
              <div class="invalid-feedback" *ngIf="bookForm.get('title')?.errors?.['required']">
                Title is required
              </div>
            </div>
            
            <div class="col-md-6">
              <label for="author" class="form-label">Author</label>
              <input type="text" 
                     class="form-control" 
                     id="author" 
                     formControlName="author"
                     placeholder="Enter author name">
            </div>
            
            <div class="col-12">
              <div class="d-flex gap-2">
                <button type="submit" 
                        class="btn btn-primary"
                        [disabled]="bookForm.invalid || isLoading">
                  <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2"></span>
                  {{ isEditing ? 'Update Book' : 'Add Book' }}
                </button>
                <button type="button" 
                        class="btn btn-secondary"
                        (click)="cancelForm()"
                        *ngIf="isEditing">
                  Cancel
                </button>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- BOOK BADGE/CART SYSTEM -->
  <div class="book-basket-section mb-4" *ngIf="addedBooks.length > 0">
    <div class="card">
      <div class="card-header bg-info text-white">
        <h5 class="mb-0">
          <i class="bi bi-basket me-2"></i>
          Your Book Basket ({{ addedBooks.length }})
        </h5>
      </div>
      <div class="card-body">
        <div class="book-badges">
          <div *ngFor="let book of addedBooks" 
               class="book-badge" 
               (click)="editBookFromBadge(book)"
               [class.selected]="selectedBookId === book.id">
            <div class="badge-content">
              <strong>{{ book.title }}</strong>
              <small *ngIf="book.author">by {{ book.author }}</small>
            </div>
            <div class="badge-actions">
              <button class="btn btn-sm btn-outline-primary" 
                      (click)="editBookFromBadge(book); $event.stopPropagation()">
                <i class="bi bi-pencil"></i>
              </button>
              <button class="btn btn-sm btn-outline-danger" 
                      (click)="removeFromBasket(book.id!); $event.stopPropagation()">
                <i class="bi bi-trash"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- EXISTING BOOKS LIST -->
  <div class="existing-books-section" *ngIf="!isLoading && books.length > 0">
    <h3 class="mb-3">All Books</h3>
    <div class="books-grid">
      <div *ngFor="let book of books" class="book-card">
        <div class="book-card-header">
          <i class="bi bi-book book-icon"></i>
          <button class="btn btn-sm btn-outline-success add-to-basket-btn"
                  (click)="addToBasket(book)"
                  [disabled]="isInBasket(book.id!)">
            <i class="bi bi-plus"></i> Add to Basket
          </button>
        </div>
        <div class="book-card-body">
          <h6 class="book-title">{{ book.title }}</h6>
          <p class="book-author" *ngIf="book.author">
            <small>by {{ book.author }}</small>
          </p>
          <div class="book-meta">
            <span class="badge bg-secondary">
              <i class="bi bi-chat-quote me-1"></i>
              {{ book.quotes?.length || 0 }} quotes
            </span>
          </div>
        </div>
        <div class="book-card-footer">
          <button class="btn btn-sm btn-primary" (click)="editBook(book)">
            <i class="bi bi-pencil"></i>
          </button>
          <button class="btn btn-sm btn-danger" (click)="deleteBook(book.id!)">
            <i class="bi bi-trash"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- LOADING & EMPTY STATES -->
  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-2">Loading books...</p>
  </div>

  <div *ngIf="!isLoading && books.length === 0 && addedBooks.length === 0" 
       class="empty-state text-center py-5">
    <i class="bi bi-book text-muted" style="font-size: 4rem;"></i>
    <h3 class="mt-3">No books yet</h3>
    <p class="text-muted">Start by adding your first book using the form above!</p>
  </div>
</div>